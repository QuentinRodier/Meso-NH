MODULE MODE_MODELN_TRIP_HANDLER
!
!
USE YOMHOOK   ,ONLY : LHOOK,   DR_HOOK
USE PARKIND1  ,ONLY : JPRB
!
IMPLICIT NONE 

INTEGER, SAVE, PRIVATE :: ICURRENT_MODEL_TRIP = -1
!$OMP THREADPRIVATE(ICURRENT_MODEL_TRIP)

CONTAINS 

FUNCTION GET_CURRENT_MODEL_INDEX_TRIP()
INTEGER :: GET_CURRENT_MODEL_INDEX_TRIP
REAL(KIND=JPRB) :: ZHOOK_HANDLE
!!
IF (LHOOK) CALL DR_HOOK('MODE_MODELN_TRIP_HANDLER:GET_CURRENT_MODEL_INDEX_TRIP',0,ZHOOK_HANDLE)
GET_CURRENT_MODEL_INDEX_TRIP = ICURRENT_MODEL_TRIP
IF (LHOOK) CALL DR_HOOK('MODE_MODELN_TRIP_HANDLER:GET_CURRENT_MODEL_INDEX_TRIP',1,ZHOOK_HANDLE)
!!
END FUNCTION GET_CURRENT_MODEL_INDEX_TRIP
!
SUBROUTINE GOTO_MODEL_TRIP(KMI, LKFROM)
!
USE MODI_GOTO_WRAPPER_TRIP
!
LOGICAL, INTENT(IN) :: LKFROM
INTEGER, INTENT(IN) :: KMI
REAL(KIND=JPRB) :: ZHOOK_HANDLE
!
IF (LHOOK) CALL DR_HOOK('MODE_MODELN_TRIP_HANDLER:GOTO_MODEL_TRIP',0,ZHOOK_HANDLE)

IF (LKFROM) THEN

  IF (ICURRENT_MODEL_TRIP == -1) THEN
    ! First call to GOTO_MODEL_TRIP
    ICURRENT_MODEL_TRIP = 1 ! Default model index
    !
    CALL GOTO_WRAPPER_TRIP   (ICURRENT_MODEL_TRIP, KMI, LKFROM)
    ICURRENT_MODEL_TRIP = KMI
    !
  ELSE
    !
    CALL GOTO_WRAPPER_TRIP   (ICURRENT_MODEL_TRIP, KMI, LKFROM)  
    ICURRENT_MODEL_TRIP = KMI 
    !
  END IF
  !
ELSE
  !
  CALL GOTO_WRAPPER_TRIP   (ICURRENT_MODEL_TRIP, KMI, LKFROM)
  ICURRENT_MODEL_TRIP = KMI  
  !
END IF
!
IF (LHOOK) CALL DR_HOOK('MODE_MODELN_TRIP_HANDLER:GOTO_MODEL_TRIP',1,ZHOOK_HANDLE)
!
END SUBROUTINE GOTO_MODEL_TRIP

END MODULE MODE_MODELN_TRIP_HANDLER

